# PMAction Mental Health Platform - Technical Specification & Implementation Guide

## Executive Summary

PMAction is a comprehensive, AI-driven mental health and wellness platform centered on "Positive Mental Action" - holding users accountable for better mental health through personalized challenges, habit tracking, therapeutic resources, and secure professional connections. The platform emphasizes privacy, security, and user-centric design with the motto "Can't Never Could" and an empathetic approach that always asks users to "tell me more."

**Core Philosophy**: Private support centered around the individual user (not public forums), utilizing AI to recommend personalized challenges, blogs, quizzes, and therapist connections based on ongoing user data and current mental health research trends.

---

## Table of Contents

1. [Platform Overview & Core Features](#platform-overview)
2. [Technology Stack Recommendations](#technology-stack)
3. [Application Platform Decision Matrix](#application-platform)
4. [Architecture & Infrastructure](#architecture)
5. [Security & Compliance Requirements](#security-compliance)
6. [Database Schema & Data Models](#database-schema)
7. [AI Personalization Engine](#ai-engine)
8. [Gamification System](#gamification)
9. [Challenge Library](#challenge-library)
10. [Integration Requirements](#integrations)
11. [MCP (Model Context Protocol) Implementation](#mcp-implementation)
12. [Development Phases](#development-phases)
13. [Cost Estimates & Cloud Hosting](#cost-estimates)

---

## 1. Platform Overview & Core Features {#platform-overview}

### 1.1 Primary User Flows

**New User Journey**:
1. Secure sign-up with multi-factor authentication
2. Privacy-focused onboarding (emphasize security features)
3. Initial mental health assessment (PHQ-9, GAD-7, custom wellness survey)
4. AI analyzes responses to recommend first challenge
5. User selects or is assigned personalized challenge
6. Dashboard displays progress, habits, journal entries
7. System continuously learns and adapts recommendations

**Returning User Journey**:
1. Secure login with biometric or MFA
2. Dashboard shows: current challenge progress, habit streaks, upcoming therapist appointments
3. Daily check-in prompts ("How are you feeling today?" with "tell me more" follow-ups)
4. Complete challenge activities, log habits, journal entries
5. Earn rewards/badges for completion
6. Receive new challenge recommendations based on progress

### 1.2 Core Features

#### User Management
- Secure account creation and authentication (OAuth 2.0, biometric, MFA)
- User profile with privacy controls
- Encrypted data storage
- Account deletion and data export (GDPR/HIPAA compliance)

#### Mental Health Assessment System
- **Initial Assessment**: PHQ-9 (depression), GAD-7 (anxiety), custom wellness questionnaire
- **Ongoing Monitoring**: Daily mood tracking, symptom tracking
- **Crisis Detection**: AI analyzes patterns; triggers alerts if concerning language detected
- **Progress Tracking**: Visual charts showing improvement over time

#### Habit Tracker
- Custom habit creation (morning, afternoon, evening routines)
- Streak tracking and visualization
- Habit completion linked to challenge progress
- Integration with wearables (optional: heart rate, sleep data)
- Reminder notifications (customizable)

#### Digital Journal
- Secure, encrypted journal entries
- Prompts based on current challenge or mood
- Voice-to-text transcription option
- Sentiment analysis for trend tracking
- Export capability for therapist sharing

#### Challenge System
- 10+ pre-built challenges (see Challenge Library section)
- Difficulty levels: Beginner, Intermediate, Advanced
- Age-appropriate versions (teen, young adult, adult)
- Progress tracking with milestones
- Gamification elements (points, badges, rewards)

#### Blog Library
- Evidence-based mental health articles
- SEO-optimized for discoverability
- Citations from peer-reviewed sources
- Positive Mental Action (PMA) section in every article
- Tags for topic categorization

#### Quiz/Assessment Library
- Self-assessment quizzes (stress, anxiety, depression screening)
- Knowledge quizzes (mental health education)
- Personality/strength assessments
- Results with personalized recommendations

#### Therapist Connection
- **Option 1**: Built-in therapist portal
- **Option 2**: API integration with Headway, BetterHelp, Talkspace
- Secure messaging between user and therapist
- Appointment scheduling
- Session notes export for therapist (user-controlled)
- Insurance verification (if using Headway)

#### AI Recommendation Engine
- Analyzes user data: journal entries, mood logs, challenge completion, quiz results
- Recommends: next challenges, relevant blog posts, quizzes, therapist consultation
- Adapts based on latest mental health research (periodic AI model updates)
- Privacy-preserving: on-device processing where possible, federated learning

#### Social/Referral System
- Referral codes for friend invitations
- Reward points for referrals (redeemable for merchandise in future)
- **No public social features** (maintains privacy)
- Optional accountability partner feature (1-on-1, encrypted)

---

## 2. Technology Stack Recommendations {#technology-stack}

### 2.1 Recommended Stack (Google Cloud + Modern Web Technologies)

**Frontend**:
- **Progressive Web App (PWA)**: React.js with Next.js framework
  - *Why*: Single codebase for web, iOS, Android; lower development cost
  - *PWA Benefits*: Offline functionality, push notifications, installable on home screen
  - *Next.js Benefits*: SEO optimization (critical for blog content), server-side rendering
- **UI Framework**: Material-UI (MUI) or Tailwind CSS
- **State Management**: Redux Toolkit or Zustand
- **Real-time Updates**: Socket.io or Firebase Realtime Database

**Backend**:
- **Primary Backend**: Node.js with Express.js OR Python with FastAPI
  - *Node.js*: Better for real-time features, large JavaScript ecosystem
  - *Python/FastAPI*: Better for AI/ML integration, data science libraries
- **API Architecture**: RESTful API + GraphQL for complex queries
- **Authentication**: Firebase Authentication or Auth0
- **Google Apps Script**: For automated workflows (e.g., scheduled emails, data sync)

**Database**:
- **Primary Database**: PostgreSQL (HIPAA-compliant on Google Cloud SQL)
  - *Why*: Relational structure for user data, ACID compliance, strong security
- **Cache Layer**: Redis (for session management, real-time leaderboards)
- **Document Storage**: Google Cloud Storage (encrypted) for journal entries, images
- **Backup Strategy**: Automated daily backups to separate region

**AI/ML**:
- **Recommendation Engine**: Google Vertex AI (AutoML) or custom TensorFlow models
- **Natural Language Processing**: Google Cloud Natural Language API
- **Sentiment Analysis**: Pre-trained models (BERT) fine-tuned on mental health data
- **Crisis Detection**: Rule-based + ML model (trained on crisis helpline data)
- **Personalization**: Collaborative filtering + content-based filtering hybrid

**Cloud Infrastructure**:
- **Primary Host**: Google Cloud Platform (GCP)
  - *Compute*: Google Kubernetes Engine (GKE) for scalability OR Cloud Run for serverless
  - *CDN*: Google Cloud CDN for global content delivery
  - *Load Balancing*: Google Cloud Load Balancer
  - *Region*: us-east-1 (primary), us-west-1 (backup for disaster recovery)
- **Alternative (Cost Comparison)**: AWS (EC2 + RDS) or Azure
  - *Cost Estimate*: GCP ~10-15% cheaper than AWS for similar services

**DevOps & Automation**:
- **CI/CD**: GitHub Actions or Google Cloud Build
- **Containerization**: Docker
- **Orchestration**: Kubernetes (GKE)
- **Monitoring**: Google Cloud Monitoring + Sentry (error tracking)
- **Logging**: Google Cloud Logging (centralized logs)

**Security**:
- **Encryption**: AES-256 encryption at rest, TLS 1.3 in transit
- **HIPAA Compliance**: Google Cloud HIPAA-compliant services with signed BAA
- **DDoS Protection**: Google Cloud Armor
- **WAF**: Web Application Firewall (Google Cloud Armor rules)
- **Secrets Management**: Google Secret Manager
- **Penetration Testing**: Quarterly third-party security audits

**Communication**:
- **Notifications**: Firebase Cloud Messaging (push notifications)
- **Email**: SendGrid or Google Workspace (HIPAA-compliant with BAA)
- **SMS**: Twilio (HIPAA-compliant tier)

### 2.2 Alternative Stack (Lower Cost for MVP)

**For MVP/Bootstrap Phase**:
- **Frontend**: React PWA hosted on Vercel (free tier)
- **Backend**: Firebase (Authentication, Firestore, Cloud Functions)
- **AI**: OpenAI API (ChatGPT API for recommendations)
- **Hosting**: Firebase Hosting + Cloud Functions
- **Estimated Cost**: $50-200/month for first 1,000 users

---

## 3. Application Platform Decision Matrix {#application-platform}

### 3.1 Platform Options Analysis

| Platform | Development Cost | Maintenance Cost | User Reach | Feature Parity | Time to Market | Recommendation |
|----------|------------------|------------------|------------|----------------|----------------|----------------|
| **Progressive Web App (PWA)** | **$$ (Medium)** | **$ (Low)** | **High** (iOS, Android, Web) | **95%** (limited offline) | **Fast** (3-4 months) | **â­ RECOMMENDED** |
| Native iOS + Android | $$$$ (Very High) | $$$ (High) | High | 100% | Slow (6-8 months) | Not Recommended (Cost) |
| React Native | $$$ (Medium-High) | $$ (Medium) | High | 90% | Medium (4-5 months) | Alternative Option |
| Flutter | $$$ (Medium-High) | $$ (Medium) | High | 92% | Medium (4-5 months) | Alternative Option |

### 3.2 Recommendation: Progressive Web App (PWA)

**Why PWA?**

1. **Cost Efficiency**: Single codebase for web, iOS, Android
   - Development: ~40% cost reduction vs. native apps
   - Maintenance: Single team, single deployment

2. **Healthcare Industry Fit**:
   - No app store approval delays (critical for urgent updates)
   - Direct updates (users always have latest version)
   - Easier HIPAA compliance (controlled environment)

3. **User Experience**:
   - Installable on home screen (feels like native app)
   - Push notifications (engagement)
   - Offline functionality (critical for journal, habit tracking)
   - Fast loading (service workers)

4. **SEO & Discoverability**:
   - Blog content indexed by Google (traffic source)
   - Progressive enhancement for search engines
   - Deep linking for content sharing

5. **Future-Proofing**:
   - Apple/Google increasingly support PWA features
   - Technology maturity and ecosystem growth
   - Easy transition to native if needed (can wrap PWA in native shell)

**PWA Limitations & Mitigation**:
- **Limited Biometric Auth on iOS**: Use WebAuthn API (supported iOS 14+)
- **Background Sync Restrictions**: Use periodic background sync API
- **Wearable Integration**: Phase 2 feature; use web APIs where available

**Decision**: Build as PWA with React + Next.js, hosted on Google Cloud Run with Cloud CDN.

---

## 4. Architecture & Infrastructure {#architecture}

### 4.1 System Architecture Diagram (Text-Based)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER DEVICES                            â”‚
â”‚         (PWA on iOS, Android, Desktop Browsers)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTPS (TLS 1.3)
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GOOGLE CLOUD CDN + LOAD BALANCER               â”‚
â”‚                     (DDoS Protection, WAF)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOUD RUN  â”‚  â”‚  CLOUD RUN   â”‚  â”‚  CLOUD RUN   â”‚
â”‚  (Frontend) â”‚  â”‚  (API)       â”‚  â”‚  (AI Engine) â”‚
â”‚  Next.js    â”‚  â”‚  Express/    â”‚  â”‚  Python/     â”‚
â”‚  PWA        â”‚  â”‚  FastAPI     â”‚  â”‚  TensorFlow  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼              â–¼                  â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLOUD SQL   â”‚  â”‚   REDIS     â”‚  â”‚  CLOUD       â”‚  â”‚  VERTEX AI â”‚
â”‚ (PostgreSQL)â”‚  â”‚  (Cache)    â”‚  â”‚  STORAGE     â”‚  â”‚  (ML Models)â”‚
â”‚ HIPAA Tier  â”‚  â”‚             â”‚  â”‚  (Encrypted) â”‚  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EXTERNAL INTEGRATIONS                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Headway  â”‚  â”‚ SendGrid â”‚  â”‚  Twilio  â”‚  â”‚ Stripe   â”‚       â”‚
â”‚  â”‚   API    â”‚  â”‚  (Email) â”‚  â”‚  (SMS)   â”‚  â”‚ (Payment)â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Microservices Architecture

**Core Services**:

1. **User Service**: Authentication, profile management, preferences
2. **Content Service**: Blogs, quizzes, challenges (read-heavy, cached)
3. **Tracking Service**: Habits, mood logs, journal entries
4. **Assessment Service**: Mental health questionnaires, scoring algorithms
5. **Recommendation Service**: AI-driven personalization engine
6. **Notification Service**: Push notifications, email, SMS
7. **Therapist Service**: Appointment scheduling, messaging, session notes
8. **Payment Service**: Subscription management, referral rewards

**Communication**:
- **Synchronous**: REST API (user-facing actions)
- **Asynchronous**: Pub/Sub (Google Cloud Pub/Sub) for event-driven actions
  - Example: User completes challenge â†’ Pub/Sub â†’ Notification Service â†’ Send congratulations

### 4.3 Data Flow

**User Action Example: Complete Daily Habit**
```
User (PWA) â†’ API Gateway â†’ Tracking Service
                â†“
         Update PostgreSQL (habit_logs table)
                â†“
         Publish event to Pub/Sub ("habit_completed")
                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼           â–¼           â–¼
Notification  Cache    Recommendation
  Service    Update      Service
    â”‚                       â”‚
    â”œâ”€ Send push           â”œâ”€ Analyze pattern
    â”‚  notification        â”‚  (async)
    â”‚  "Great job!"        â””â”€ Queue new
    â”‚                         recommendation
    â””â”€ Update streak
       in Redis cache
```

---

## 5. Security & Compliance Requirements {#security-compliance}

### 5.1 HIPAA Compliance Checklist

**Administrative Safeguards**:
- [ ] Security Officer designated
- [ ] Staff training program (annual HIPAA training)
- [ ] Risk assessment conducted (annual)
- [ ] Incident response plan documented
- [ ] Business Associate Agreements (BAAs) with all vendors:
  - [ ] Google Cloud (HIPAA tier)
  - [ ] SendGrid (HIPAA plan)
  - [ ] Twilio (HIPAA plan)
  - [ ] Headway (if integrated)

**Physical Safeguards**:
- [ ] Data centers: Google Cloud HIPAA-compliant facilities
- [ ] Access controls: Role-based access (RBAC) in GCP
- [ ] Workstation security: Company laptops with full-disk encryption, MFA

**Technical Safeguards**:
- [ ] **Encryption at Rest**: AES-256 (Google Cloud SQL, Cloud Storage)
- [ ] **Encryption in Transit**: TLS 1.3 (all API calls)
- [ ] **Access Controls**: 
  - OAuth 2.0 + MFA for user authentication
  - Service accounts with least-privilege for backend services
- [ ] **Audit Logging**: 
  - Google Cloud Audit Logs (all API access logged)
  - User activity logs (who accessed what, when)
  - 6-year retention for HIPAA compliance
- [ ] **Data Integrity**: 
  - Database checksums
  - Blockchain-style append-only logs for critical data (optional)
- [ ] **Automatic Logoff**: 15-minute inactivity timeout
- [ ] **Disaster Recovery**: 
  - Automated daily backups (30-day retention)
  - Cross-region replication (us-east-1 â†’ us-west-1)
  - RTO: 4 hours, RPO: 1 hour

### 5.2 GDPR Compliance (EU Users)

**User Rights Implementation**:
- **Right to Access**: "Download My Data" button (JSON export)
- **Right to Erasure**: "Delete My Account" (hard delete after 30-day grace period)
- **Right to Portability**: Export in machine-readable format (JSON, CSV)
- **Right to Rectification**: User can edit all profile data
- **Consent Management**: Granular consent toggles (analytics, marketing, research)

**Data Minimization**:
- Only collect necessary data
- Anonymous analytics where possible (no PII in Google Analytics)

**Data Silos (HIPAA vs. GDPR Conflict Resolution)**:
- **US Users**: 6-year data retention (HIPAA requirement)
- **EU Users**: Data deleted upon request (GDPR Right to Erasure)
- **Implementation**: `user.region` field determines retention policy

### 5.3 Security Best Practices

**Application Security**:
- **Input Validation**: Sanitize all user inputs (prevent XSS, SQL injection)
- **OWASP Top 10**: Regular audits against OWASP vulnerabilities
- **Dependency Scanning**: Automated scans (Snyk, Dependabot)
- **API Rate Limiting**: Prevent abuse (100 requests/minute per user)
- **CAPTCHA**: On signup, sensitive actions (prevent bots)

**Data Security**:
- **PHI Isolation**: Separate database tables for PHI vs. non-PHI
- **No PHI in Logs**: Scrub logs of sensitive data before storage
- **No PHI in URLs**: Use POST requests, never GET with PHI
- **Secure Delete**: Overwrite data before deletion (not just soft delete)

**Monitoring & Incident Response**:
- **24/7 Monitoring**: Google Cloud Monitoring alerts
- **Incident Response Team**: On-call rotation
- **Breach Notification**: Protocol for <72-hour notification (GDPR, HIPAA)

### 5.4 Privacy-First Design

**"Screaming Security" Features**:
- **Landing Page**: Prominent security badges (HIPAA, SSL, encryption icons)
- **Onboarding**: "Your data is encrypted and private" message
- **Settings**: Privacy dashboard (see what data is stored, delete anytime)
- **Transparency**: Public privacy policy (written in plain English)
- **No Data Selling**: Explicit promise (build trust)

**Data Handling**:
- **Therapist Data Sharing**: User explicitly opts-in, controls what is shared
- **AI Processing**: On-device where possible (privacy-preserving ML)
- **Third-Party Integrations**: Minimal data sharing, user consent required

---

## 6. Database Schema & Data Models {#database-schema}

### 6.1 Core Tables (PostgreSQL)

**users**
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  phone VARCHAR(20),
  password_hash TEXT NOT NULL,
  auth_provider VARCHAR(50) DEFAULT 'email', -- email, google, apple
  region VARCHAR(10) DEFAULT 'US', -- for GDPR/HIPAA compliance
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  last_login TIMESTAMP,
  is_active BOOLEAN DEFAULT TRUE,
  mfa_enabled BOOLEAN DEFAULT FALSE,
  mfa_secret TEXT,
  consent_analytics BOOLEAN DEFAULT FALSE,
  consent_marketing BOOLEAN DEFAULT FALSE
);
```

**user_profiles**
```sql
CREATE TABLE user_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  first_name VARCHAR(100),
  last_name VARCHAR(100),
  date_of_birth DATE,
  gender VARCHAR(50),
  timezone VARCHAR(50) DEFAULT 'UTC',
  avatar_url TEXT,
  bio TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**mental_health_assessments**
```sql
CREATE TABLE mental_health_assessments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  assessment_type VARCHAR(50) NOT NULL, -- PHQ-9, GAD-7, custom
  score INTEGER,
  severity VARCHAR(50), -- minimal, mild, moderate, severe
  responses JSONB, -- encrypted JSON of Q&A
  taken_at TIMESTAMP DEFAULT NOW(),
  notes TEXT
);
```

**habits**
```sql
CREATE TABLE habits (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  routine_type VARCHAR(50), -- morning, afternoon, evening, anytime
  frequency VARCHAR(50) DEFAULT 'daily', -- daily, weekly, custom
  target_count INTEGER DEFAULT 1,
  icon VARCHAR(50),
  color VARCHAR(20),
  created_at TIMESTAMP DEFAULT NOW(),
  is_active BOOLEAN DEFAULT TRUE
);
```

**habit_logs**
```sql
CREATE TABLE habit_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  habit_id UUID REFERENCES habits(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  completion_date DATE NOT NULL,
  completed_at TIMESTAMP DEFAULT NOW(),
  notes TEXT,
  mood VARCHAR(50), -- optional mood after completing habit
  UNIQUE(habit_id, completion_date) -- prevent duplicate logs per day
);
```

**journal_entries**
```sql
CREATE TABLE journal_entries (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  entry_text TEXT NOT NULL, -- encrypted
  sentiment_score FLOAT, -- -1.0 (negative) to 1.0 (positive)
  sentiment_magnitude FLOAT,
  keywords TEXT[], -- extracted keywords for search
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  is_shared_with_therapist BOOLEAN DEFAULT FALSE
);
```

**challenges**
```sql
CREATE TABLE challenges (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  description TEXT NOT NULL,
  category VARCHAR(100), -- relationships, school, empathy, habits, autism-awareness
  difficulty VARCHAR(50) DEFAULT 'beginner', -- beginner, intermediate, advanced
  age_group VARCHAR(50), -- teen, young-adult, adult, all
  duration_days INTEGER DEFAULT 7,
  total_activities INTEGER,
  icon VARCHAR(50),
  image_url TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  is_active BOOLEAN DEFAULT TRUE
);
```

**challenge_activities**
```sql
CREATE TABLE challenge_activities (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  challenge_id UUID REFERENCES challenges(id) ON DELETE CASCADE,
  day_number INTEGER NOT NULL,
  title VARCHAR(255) NOT NULL,
  description TEXT NOT NULL,
  activity_type VARCHAR(50), -- reading, reflection, action, quiz
  content JSONB, -- specific content (e.g., journal prompts, quiz questions)
  estimated_minutes INTEGER DEFAULT 10,
  order_index INTEGER,
  UNIQUE(challenge_id, day_number)
);
```

**user_challenges**
```sql
CREATE TABLE user_challenges (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  challenge_id UUID REFERENCES challenges(id) ON DELETE CASCADE,
  status VARCHAR(50) DEFAULT 'active', -- active, completed, abandoned
  started_at TIMESTAMP DEFAULT NOW(),
  completed_at TIMESTAMP,
  current_day INTEGER DEFAULT 1,
  total_points_earned INTEGER DEFAULT 0,
  notes TEXT
);
```

**user_challenge_progress**
```sql
CREATE TABLE user_challenge_progress (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_challenge_id UUID REFERENCES user_challenges(id) ON DELETE CASCADE,
  activity_id UUID REFERENCES challenge_activities(id) ON DELETE CASCADE,
  completed_at TIMESTAMP,
  user_response TEXT, -- user's reflection/answer
  points_earned INTEGER DEFAULT 0,
  UNIQUE(user_challenge_id, activity_id)
);
```

**blog_posts**
```sql
CREATE TABLE blog_posts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  slug VARCHAR(255) UNIQUE NOT NULL, -- SEO-friendly URL
  excerpt TEXT,
  content TEXT NOT NULL, -- Markdown format
  author_id UUID REFERENCES users(id),
  featured_image_url TEXT,
  category VARCHAR(100),
  tags TEXT[],
  meta_description VARCHAR(160), -- SEO
  meta_keywords TEXT[],
  read_time_minutes INTEGER,
  pma_section TEXT, -- Positive Mental Action content
  citations JSONB, -- array of citations
  published_at TIMESTAMP,
  updated_at TIMESTAMP DEFAULT NOW(),
  view_count INTEGER DEFAULT 0,
  is_published BOOLEAN DEFAULT FALSE
);
```

**quizzes**
```sql
CREATE TABLE quizzes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  description TEXT,
  quiz_type VARCHAR(50), -- assessment, knowledge, personality
  category VARCHAR(100),
  estimated_minutes INTEGER DEFAULT 5,
  questions JSONB NOT NULL, -- array of question objects
  scoring_logic JSONB, -- how to calculate score/results
  result_interpretations JSONB, -- text for different score ranges
  created_at TIMESTAMP DEFAULT NOW(),
  is_active BOOLEAN DEFAULT TRUE
);
```

**user_quiz_results**
```sql
CREATE TABLE user_quiz_results (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  quiz_id UUID REFERENCES quizzes(id) ON DELETE CASCADE,
  answers JSONB NOT NULL, -- user's answers (encrypted)
  score INTEGER,
  result_category VARCHAR(100),
  interpretation TEXT,
  taken_at TIMESTAMP DEFAULT NOW()
);
```

**therapist_profiles** (if built-in therapist portal)
```sql
CREATE TABLE therapist_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  license_number VARCHAR(100) NOT NULL,
  license_state VARCHAR(50),
  specialties TEXT[],
  bio TEXT,
  credentials VARCHAR(255), -- PhD, LCSW, etc.
  rate_per_session DECIMAL(10, 2),
  accepts_insurance BOOLEAN DEFAULT FALSE,
  insurance_providers TEXT[],
  availability JSONB, -- schedule slots
  is_verified BOOLEAN DEFAULT FALSE,
  verified_at TIMESTAMP
);
```

**appointments**
```sql
CREATE TABLE appointments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  therapist_id UUID REFERENCES therapist_profiles(id) ON DELETE CASCADE,
  appointment_time TIMESTAMP NOT NULL,
  duration_minutes INTEGER DEFAULT 50,
  status VARCHAR(50) DEFAULT 'scheduled', -- scheduled, completed, cancelled, no-show
  meeting_url TEXT, -- video call link
  notes TEXT, -- therapist's notes (encrypted)
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

**messages** (therapist-user messaging)
```sql
CREATE TABLE messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  sender_id UUID REFERENCES users(id),
  recipient_id UUID REFERENCES users(id),
  message_text TEXT NOT NULL, -- encrypted
  read_at TIMESTAMP,
  sent_at TIMESTAMP DEFAULT NOW(),
  conversation_id UUID -- group messages by conversation
);
```

**rewards**
```sql
CREATE TABLE rewards (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(255) NOT NULL,
  description TEXT,
  reward_type VARCHAR(50), -- badge, points, merchandise, discount
  icon_url TEXT,
  points_cost INTEGER DEFAULT 0,
  merchandise_item_id UUID, -- future: link to merchandise store
  is_active BOOLEAN DEFAULT TRUE
);
```

**user_rewards**
```sql
CREATE TABLE user_rewards (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  reward_id UUID REFERENCES rewards(id) ON DELETE CASCADE,
  earned_at TIMESTAMP DEFAULT NOW(),
  redeemed_at TIMESTAMP,
  is_redeemed BOOLEAN DEFAULT FALSE
);
```

**referrals**
```sql
CREATE TABLE referrals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  referrer_user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  referred_user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  referral_code VARCHAR(50) UNIQUE NOT NULL,
  status VARCHAR(50) DEFAULT 'pending', -- pending, completed
  reward_points INTEGER DEFAULT 100,
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### 6.2 Indexes for Performance

```sql
-- User lookups
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_active ON users(is_active);

-- Habit tracking (frequent queries)
CREATE INDEX idx_habit_logs_user_date ON habit_logs(user_id, completion_date);
CREATE INDEX idx_habits_user ON habits(user_id) WHERE is_active = TRUE;

-- Journal search
CREATE INDEX idx_journal_user_created ON journal_entries(user_id, created_at DESC);
CREATE INDEX idx_journal_keywords ON journal_entries USING GIN(keywords);

-- Challenge progress
CREATE INDEX idx_user_challenges_active ON user_challenges(user_id, status);

-- Blog SEO
CREATE INDEX idx_blog_posts_slug ON blog_posts(slug);
CREATE INDEX idx_blog_posts_published ON blog_posts(published_at DESC) WHERE is_published = TRUE;
CREATE INDEX idx_blog_posts_tags ON blog_posts USING GIN(tags);
```

---

## 7. AI Personalization Engine {#ai-engine}

### 7.1 Recommendation Algorithm

**Input Data**:
- User profile (age, preferences)
- Mental health assessment scores (PHQ-9, GAD-7)
- Mood logs (past 30 days)
- Journal entries (sentiment analysis)
- Challenge completion history
- Habit adherence rate
- Quiz results
- Time spent on blog topics (engagement data)

**Output Recommendations**:
1. **Next Challenge**: Based on current progress, interests, and difficulty adaptation
2. **Blog Articles**: 3-5 articles matching user's current needs
3. **Quizzes**: Self-assessment or knowledge quizzes relevant to user journey
4. **Therapist Consultation**: Triggered if assessment scores indicate need

### 7.2 Machine Learning Models

**Model 1: Challenge Recommendation (Collaborative Filtering)**
- **Algorithm**: Matrix Factorization (ALS - Alternating Least Squares)
- **Training Data**: User-challenge completion matrix
- **Output**: Top 5 challenges for user
- **Update Frequency**: Weekly (batch training)

**Model 2: Content Recommendation (Content-Based Filtering)**
- **Algorithm**: TF-IDF + Cosine Similarity
- **Input**: User's journal entries, mood logs
- **Output**: Blog posts with similar themes
- **Update Frequency**: Real-time (pre-computed embeddings)

**Model 3: Sentiment Analysis (NLP)**
- **Pre-trained Model**: BERT fine-tuned on mental health text
- **Input**: Journal entry text
- **Output**: Sentiment score (-1 to 1), keywords
- **Privacy**: On-device processing (future: federated learning)

**Model 4: Crisis Detection (Rule-Based + ML)**
- **Rules**: Keyword detection (suicide, self-harm mentions)
- **ML Model**: Binary classifier (crisis vs. non-crisis)
- **Training Data**: Anonymized crisis helpline data (with consent)
- **Output**: Alert + resource links (crisis hotline, therapist recommendation)
- **Human-in-Loop**: Flagged entries reviewed by licensed clinicians (if consent given)

### 7.3 Personalization Logic

**Daily Recommendation Flow**:
```
User logs in
  â†“
Check last assessment date
  â†“
If > 14 days â†’ Prompt reassessment
  â†“
Fetch user's mood log (today)
  â†“
AI analyzes: mood + recent journal + habit completion
  â†“
Generate recommendation object:
  {
    "suggested_challenge": "Building Positive Habits",
    "reason": "You've consistently tracked 3 habits this week. Ready for the next level?",
    "blog_articles": [
      {"title": "5 Habits for Better Mental Health", "url": "/blog/..."},
      {"title": "Why Consistency Matters", "url": "/blog/..."}
    ],
    "quiz": {"title": "What's Your Habit Style?", "url": "/quiz/..."},
    "therapist_prompt": false
  }
  â†“
Display in dashboard card: "Here's what we recommend today..."
  â†“
User accepts â†’ Track engagement â†’ Retrain model
```

**Adaptive Difficulty**:
- If user completes challenge with 90%+ activities â†’ Suggest harder challenge
- If user abandons challenge â†’ Suggest easier or different category

### 7.4 Privacy-Preserving AI

**On-Device Processing**:
- Sentiment analysis runs locally (via TensorFlow.js in PWA)
- Only aggregated scores sent to server (not raw journal text)

**Federated Learning (Future)**:
- AI model trains on user's device
- Only model updates (not data) sent to central server
- Aggregated improvements benefit all users

**Data Anonymization for Research**:
- Users opt-in to share anonymized data for AI improvement
- PII stripped before export
- IRB-approved research protocols

---

## 8. Gamification System {#gamification}

### 8.1 Gamification Elements

**Points System**:
- Complete daily habit: **10 points**
- Complete challenge activity: **25 points**
- Finish entire challenge: **500 points bonus**
- Write journal entry (100+ words): **15 points**
- Take quiz: **20 points**
- Maintain 7-day habit streak: **100 points bonus**
- Refer a friend (friend signs up): **200 points**

**Levels**:
- **Level 1** (Beginner): 0-500 points
- **Level 2** (Explorer): 501-1,500 points
- **Level 3** (Achiever): 1,501-3,000 points
- **Level 4** (Champion): 3,001-5,000 points
- **Level 5** (Master): 5,000+ points

**Badges** (Examples):
- ðŸŒŸ **First Step**: Complete your first habit
- ðŸ”¥ **Streak Master**: 30-day habit streak
- ðŸŽ¯ **Challenge Champion**: Complete 5 challenges
- ðŸ“ **Reflective Writer**: 50 journal entries
- ðŸ§  **Knowledge Seeker**: Complete 10 quizzes
- ðŸ¤ **Community Builder**: Refer 5 friends
- ðŸ’ª **Resilience Warrior**: Complete "Building Resilience" challenge

**Rewards Redemption**:
- **Future Phase**: Merchandise store (t-shirts, journals, stickers)
- **Points-to-Dollars**: 1,000 points = $10 store credit
- **Free Resources**: Unlock premium content (e.g., guided meditations)

### 8.2 Leaderboard (Optional, Privacy-Preserving)

**Anonymous Leaderboard**:
- Users opt-in to appear (username only, no real names)
- Weekly/monthly top 10 by points earned
- No sensitive data displayed (only points)

**Social Features (Future)**:
- Accountability partner: Invite 1 friend, share progress (opt-in, encrypted)
- No public forums (maintains privacy)

---

## 9. Challenge Library {#challenge-library}

### 9.1 Initial 12 Challenges

**1. Building Better Work Relationships**
- **Duration**: 7 days
- **Target Audience**: Adults (ages 25-65)
- **Category**: Relationships, Workplace
- **Activities**:
  - Day 1: Reflect on your current work relationships (journal prompt)
  - Day 2: Practice active listening with a colleague
  - Day 3: Give genuine compliment to coworker
  - Day 4: Set boundaries (say no to one non-urgent request)
  - Day 5: Ask for feedback from manager or peer
  - Day 6: Share a win or success with team
  - Day 7: Plan a coffee chat with someone new
- **Rewards**: 500 points + "Team Player" badge

**2. Building Better School Relationships** (Teen Version)
- **Duration**: 7 days
- **Target Audience**: Teens (ages 13-18)
- **Category**: Relationships, School
- **Activities**:
  - Day 1: Identify one person you'd like to know better
  - Day 2: Smile and say hi to 3 classmates
  - Day 3: Join a study group or club activity
  - Day 4: Practice empathy (imagine someone else's day)
  - Day 5: Stand up for someone being treated unfairly
  - Day 6: Share a kind note or message
  - Day 7: Reflect on how relationships have changed this week
- **Rewards**: 500 points + "Friendship Builder" badge

**3. Understanding Autism: Building Empathy**
- **Duration**: 10 days
- **Target Audience**: All ages
- **Category**: Empathy, Education
- **Activities**:
  - Day 1: Learn about autism spectrum (read article)
  - Day 2: Watch a video of someone sharing their autism experience
  - Day 3: Sensory simulation exercise (experience sensory overload)
  - Day 4: Communication challenge (practice non-verbal communication)
  - Day 5: Routine disruption reflection (imagine your routine suddenly changing)
  - Day 6: Read about neurodiversity and strengths of autism
  - Day 7: Quiz on autism myths vs. facts
  - Day 8: Practice inclusive language
  - Day 9: Support an autism advocacy organization (learn about resources)
  - Day 10: Journal about what you learned and how you'll apply it
- **Rewards**: 700 points + "Empathy Advocate" badge

**4. Building Positive Habits**
- **Duration**: 21 days (habit formation cycle)
- **Target Audience**: All ages
- **Category**: Self-improvement, Habits
- **Activities**:
  - Days 1-3: Choose 3 habits to build (morning, afternoon, evening)
  - Days 4-7: Track daily, identify obstacles
  - Days 8-14: Build consistency, celebrate small wins
  - Days 15-21: Reflect on progress, adjust habits
  - Daily: Use app's habit tracker feature
- **Rewards**: 1,000 points + "Habit Master" badge

**5. Overcoming Social Anxiety**
- **Duration**: 14 days
- **Target Audience**: Adults, Young Adults
- **Category**: Anxiety, Social Skills
- **Activities**:
  - Day 1: Understand social anxiety (read + quiz)
  - Day 2: Identify anxiety triggers (journal)
  - Day 3-4: Learn breathing exercises (practice 3x/day)
  - Day 5: Exposure ladder (create plan from least to most scary social situations)
  - Days 6-12: Complete exposure ladder steps (one per day)
  - Day 13: Celebrate wins, reflect on growth
  - Day 14: Plan next steps for continued progress
- **Rewards**: 800 points + "Brave Heart" badge

**6. Mindfulness & Stress Reduction**
- **Duration**: 7 days
- **Target Audience**: All ages
- **Category**: Mindfulness, Stress Management
- **Activities**:
  - Day 1: Introduction to mindfulness (5-min guided meditation)
  - Day 2: Body scan meditation
  - Day 3: Mindful eating exercise
  - Day 4: Walking meditation
  - Day 5: Gratitude practice (list 10 things you're grateful for)
  - Day 6: Loving-kindness meditation
  - Day 7: Create your own mindfulness routine
- **Rewards**: 500 points + "Zen Master" badge

**7. Digital Detox: Reclaiming Your Time**
- **Duration**: 7 days
- **Target Audience**: All ages
- **Category**: Digital Wellness, Self-care
- **Activities**:
  - Day 1: Track screen time (use phone's built-in tracker)
  - Day 2: Delete one unused app, turn off 3 notifications
  - Day 3: Phone-free hour before bed
  - Day 4: Replace scrolling with offline activity (read, walk, hobby)
  - Day 5: Social media pause (no social media for 24 hours)
  - Day 6: Reflect on digital habits (journal)
  - Day 7: Create sustainable digital boundaries
- **Rewards**: 500 points + "Unplugged" badge

**8. Sleep Hygiene Challenge**
- **Duration**: 14 days
- **Target Audience**: All ages
- **Category**: Sleep, Physical Health
- **Activities**:
  - Days 1-2: Track current sleep patterns
  - Day 3: Learn about sleep hygiene (article + quiz)
  - Days 4-14: Implement sleep routine (consistent bedtime, no screens 1hr before bed, cool room, etc.)
  - Daily: Log sleep quality in app
- **Rewards**: 800 points + "Sleep Champion" badge

**9. Gratitude Practice**
- **Duration**: 30 days
- **Target Audience**: All ages
- **Category**: Positive Psychology, Mindfulness
- **Activities**:
  - Daily: Write 3 things you're grateful for (in app journal)
  - Weekly check-in: Reflect on mood changes
  - End of month: Review all entries, notice patterns
- **Rewards**: 1,500 points + "Grateful Heart" badge

**10. Combating Loneliness**
- **Duration**: 14 days
- **Target Audience**: Adults, Seniors
- **Category**: Relationships, Connection
- **Activities**:
  - Day 1: Understand loneliness vs. being alone
  - Day 2-3: Identify sources of loneliness (journal)
  - Day 4: Reach out to one old friend
  - Day 5: Join an online or in-person community (hobby group, class)
  - Day 6-10: Weekly commitment (attend 2 social events or virtual hangouts)
  - Day 11-13: Practice self-compassion (you are not alone in feeling this way)
  - Day 14: Create ongoing connection plan
- **Rewards**: 800 points + "Connection Builder" badge

**11. Body Positivity & Self-Esteem**
- **Duration**: 10 days
- **Target Audience**: Teens, Young Adults
- **Category**: Self-esteem, Body Image
- **Activities**:
  - Day 1: Challenge negative self-talk (list + reframe 5 criticisms)
  - Day 2: Mirror affirmations (practice saying kind things to yourself)
  - Day 3: Unfollow social media accounts that make you feel bad
  - Day 4: Identify 5 non-physical qualities you love about yourself
  - Day 5: Movement for joy (not punishment) - dance, walk, stretch
  - Day 6-9: Daily affirmations + gratitude for your body
  - Day 10: Celebrate your progress
- **Rewards**: 700 points + "Self-Love Warrior" badge

**12. Managing Depression: Small Steps**
- **Duration**: 14 days
- **Target Audience**: Adults, Young Adults (with therapist oversight recommended)
- **Category**: Depression, Mental Health
- **Activities**:
  - Day 1: Take PHQ-9 assessment (track baseline)
  - Day 2-3: Behavioral activation (identify one enjoyable activity per day)
  - Day 4-7: Schedule and complete at least one pleasurable activity daily
  - Day 8-10: Social connection (reach out to 1 person)
  - Day 11-13: Physical activity (10-min walk daily)
  - Day 14: Retake PHQ-9, reflect on progress
  - **Note**: App prompts user to consider therapist support if PHQ-9 score is moderate or above
- **Rewards**: 800 points + "Small Steps, Big Wins" badge

### 9.2 Future Challenge Ideas (Phase 2+)

- Anger Management
- Parenting with Patience
- LGBTQ+ Mental Health
- Financial Wellness & Stress
- Grief & Loss Support
- PTSD Coping Skills
- Time Management & Productivity
- Setting Boundaries
- Conflict Resolution
- Creativity & Mental Health

---

## 10. Integration Requirements {#integrations}

### 10.1 Therapist Platform Integration (Headway API)

**Option 1: Built-in Therapist Portal**
- **Pros**: Full control, unified UX, direct revenue
- **Cons**: High development cost, therapist recruitment challenge, licensing complexity
- **Cost**: ~$50-100K development + ongoing compliance

**Option 2: Headway API Integration** â­ RECOMMENDED
- **Pros**: Established therapist network (60,000+ providers), insurance billing handled, faster launch
- **Cons**: Less control, revenue share model
- **Implementation**:
  - User searches therapists via Headway API (filter by location, specialty, insurance)
  - Booking flows through Headway (appointments, video sessions)
  - Session notes: User can export from PMAction app, share with therapist
  - Headway does not have public API documented (as of 2025) â†’ Need to contact Headway for partnership
- **Alternative**: BetterHelp, Talkspace APIs (if Headway unavailable)

**Action Item**: Contact Headway for API access or partnership discussion.

### 10.2 Email Service (SendGrid)

**Use Cases**:
- Welcome email (account verification)
- Password reset
- Weekly progress summary
- Challenge completion congratulations
- Blog post notifications (opt-in)
- Therapist appointment reminders

**HIPAA Compliance**: SendGrid HIPAA plan (requires BAA)

**Cost**: ~$15/month for 5,000 emails

### 10.3 SMS Service (Twilio)

**Use Cases**:
- Habit reminders (opt-in)
- Appointment reminders
- Crisis hotline number (if app detects concerning language)

**HIPAA Compliance**: Twilio Healthcare plan (requires BAA)

**Cost**: ~$0.0075 per SMS (estimate $50-100/month for 10,000 users)

### 10.4 Payment Processing (Stripe)

**Use Cases**:
- Subscription payments (premium tier - future)
- Merchandise purchases (future)
- Therapist session co-pays (if applicable)

**Compliance**: PCI-DSS compliant

**Cost**: 2.9% + $0.30 per transaction

### 10.5 Wearable Integration (Future Phase)

**APIs**:
- **Apple HealthKit**: Heart rate, sleep, activity data
- **Google Fit**: Android equivalent
- **Fitbit API**: Wearable data

**Use Case**: Correlate physical activity, sleep with mood/mental health trends

**Privacy**: Users explicitly opt-in, data processed on-device

### 10.6 Calendar Integration (Google Calendar API)

**Use Case**: Sync therapist appointments to user's calendar

**Implementation**: Google Calendar API (OAuth 2.0)

---

## 11. MCP (Model Context Protocol) Implementation {#mcp-implementation}

### 11.1 What is MCP?

**Model Context Protocol (MCP)**: An open standard by Anthropic for AI models to interact with external tools/data sources.

**Use Case for PMAction**: Enable AI assistants (Claude, ChatGPT, Gemini) to access user's mental health data (with consent) for personalized recommendations.

### 11.2 MCP Server Architecture

**PMAction MCP Server**:
```
User â†’ Claude Desktop â†’ MCP Client â†’ PMAction MCP Server â†’ PMAction API
```

**Capabilities**:
- **Tool 1**: `get_user_mood_log` - Fetch recent mood entries
- **Tool 2**: `get_challenge_progress` - Get current challenge status
- **Tool 3**: `recommend_next_action` - AI suggests next habit/challenge
- **Tool 4**: `log_journal_entry` - Create new journal entry
- **Tool 5**: `search_blog_posts` - Find relevant mental health articles

### 11.3 Implementation Steps

**Step 1: Create MCP Server (Python)**
```python
from mcp import Server, Tool

server = Server("PMAction MCP Server")

@server.tool()
async def get_user_mood_log(user_id: str, days: int = 7):
    """Fetch user's mood log for the last N days."""
    # Call PMAction API
    mood_data = await fetch_mood_logs(user_id, days)
    return mood_data

@server.tool()
async def recommend_next_action(user_id: str, context: str):
    """AI recommends next mental health action based on user context."""
    # Call PMAction Recommendation Engine
    recommendation = await get_personalized_recommendation(user_id, context)
    return recommendation

# Start MCP server
server.run()
```

**Step 2: Authentication**
- **OAuth 2.0**: User logs into PMAction via MCP client (Claude Desktop)
- **Scopes**: `read:mood_log`, `read:challenges`, `write:journal`, `read:blog`
- **Token**: Short-lived access token (1 hour), refresh token (30 days)

**Step 3: Deploy MCP Server**
- **Hosting**: Google Cloud Run (serverless, auto-scaling)
- **URL**: `https://mcp.pmaction.com`
- **Documentation**: OpenAPI spec for MCP tools

**Step 4: Register with MCP Clients**
- **Claude Desktop**: Add MCP server URL in settings
- **VS Code Copilot**: Configure MCP extension
- **Custom Clients**: Provide SDK/documentation

### 11.4 Privacy & Security for MCP

**Data Minimization**: Only expose necessary data (no full journal text without explicit request)

**User Consent**: MCP access requires user opt-in (separate from app signup)

**Audit Logging**: All MCP API calls logged (who accessed what, when)

**Rate Limiting**: 100 requests/hour per MCP client

---

## 12. Development Phases {#development-phases}

### Phase 1: MVP (Months 1-4) - Core Features

**Goal**: Launch functional PWA with essential features

**Features**:
- User authentication (email/password, Google OAuth)
- User profile and onboarding
- Mental health assessment (PHQ-9, GAD-7)
- Habit tracker (create, log, streak tracking)
- Digital journal (text entries, basic sentiment analysis)
- 3 initial challenges (Building Positive Habits, Mindfulness, Digital Detox)
- Basic blog CMS (5-10 articles)
- Dashboard (overview of progress)
- Basic AI recommendations (rule-based, not ML yet)

**Tech Stack**: React PWA, Node.js/Express, PostgreSQL, Google Cloud Run, Firebase Auth

**Team**: 2 full-stack developers, 1 UI/UX designer, 1 product manager (part-time)

**Cost Estimate**: $40,000-60,000 (development) + $500-1,000/month (hosting)

**Timeline**: 16 weeks

### Phase 2: Enhanced Features (Months 5-7)

**Goal**: Add gamification, quizzes, and ML recommendations

**Features**:
- Full gamification system (points, badges, levels)
- 5 additional challenges
- Quiz library (5-10 quizzes)
- AI/ML recommendation engine (train initial models)
- Referral system
- Email notifications (SendGrid integration)
- SEO optimization for blog
- Mobile app improvements (PWA enhancements)

**Team**: Same team + 1 ML engineer (part-time)

**Cost Estimate**: $30,000-40,000 (development)

**Timeline**: 12 weeks

### Phase 3: Therapist Integration (Months 8-10)

**Goal**: Connect users with therapists

**Features**:
- Therapist platform integration (Headway API or built-in portal)
- Appointment scheduling
- Secure messaging
- Session notes export
- Crisis detection algorithm (rule-based + ML)
- SMS notifications (Twilio integration)

**Team**: Same team + 1 backend specialist (security focus)

**Cost Estimate**: $40,000-50,000 (development)

**Timeline**: 12 weeks

### Phase 4: Advanced AI & Community (Months 11-14)

**Goal**: Sophisticated AI, community features, monetization

**Features**:
- Advanced AI personalization (federated learning pilot)
- On-device sentiment analysis (TensorFlow.js)
- Accountability partner feature (1-on-1 encrypted chat)
- Merchandise store (rewards redemption)
- Premium subscription tier (advanced features, ad-free)
- Wearable integration (Apple Health, Google Fit)
- Multi-language support (Spanish, French)
- MCP server for AI assistants

**Team**: Full team + 1 mobile/wearable specialist

**Cost Estimate**: $50,000-70,000 (development)

**Timeline**: 16 weeks

### Phase 5: Scale & Optimize (Ongoing)

**Goal**: Grow user base, optimize performance, continuous improvement

**Features**:
- A/B testing framework
- Advanced analytics (user behavior, retention)
- More challenges (expand to 20+)
- Partnerships (mental health organizations, employers)
- White-label option (for clinics, universities)
- Clinical trials (validate effectiveness)

**Team**: Full team + marketing, customer success

**Cost**: Variable (depends on growth)

---

## 13. Cost Estimates & Cloud Hosting {#cost-estimates}

### 13.1 Monthly Hosting Costs (Google Cloud Platform)

**Assumptions**: 10,000 active users, 50,000 monthly API calls, 100GB data storage

| Service | Configuration | Monthly Cost |
|---------|--------------|--------------|
| **Cloud Run** (Frontend) | 2 instances, 1GB RAM each | $50 |
| **Cloud Run** (API Backend) | 3 instances, 2GB RAM each | $120 |
| **Cloud SQL** (PostgreSQL) | db-custom-1-3840 (1 vCPU, 3.75GB RAM) | $60 |
| **Redis** (Cache) | 1GB memory | $30 |
| **Cloud Storage** | 100GB (encrypted) | $2 |
| **Cloud CDN** | 500GB data transfer | $40 |
| **Vertex AI** (ML inference) | 10K predictions/month | $50 |
| **Cloud Natural Language API** | 5K requests/month | $10 |
| **Load Balancer** | 1 load balancer | $18 |
| **Cloud Logging & Monitoring** | Standard tier | $25 |
| **Secret Manager** | 100 secrets | $5 |
| **SendGrid** (Email) | 10K emails/month | $20 |
| **Twilio** (SMS) | 1K SMS/month | $10 |
| **Backup & Disaster Recovery** | Daily backups, cross-region | $30 |
| **Total** | | **~$470/month** |

**Cost Per User**: $0.047/month (at 10,000 users)

**Scaling**:
- **100K users**: ~$2,500-3,000/month (economies of scale)
- **1M users**: ~$15,000-20,000/month

### 13.2 AWS vs. GCP Cost Comparison (Same Config)

| Provider | Monthly Cost (10K users) |
|----------|--------------------------|
| **Google Cloud** | **$470** â­ |
| **AWS** | $550 |
| **Azure** | $520 |

**Winner**: Google Cloud (10-15% cheaper for this use case)

### 13.3 Development Costs Summary

| Phase | Duration | Cost |
|-------|----------|------|
| Phase 1 (MVP) | 4 months | $40K-60K |
| Phase 2 (Enhanced) | 3 months | $30K-40K |
| Phase 3 (Therapist) | 3 months | $40K-50K |
| Phase 4 (Advanced) | 4 months | $50K-70K |
| **Total Year 1** | **14 months** | **$160K-220K** |

### 13.4 Ongoing Annual Costs (Post-Launch)

| Category | Annual Cost |
|----------|-------------|
| Hosting (10K users) | $5,640 |
| Hosting (100K users) | $36,000 |
| Third-party APIs (SendGrid, Twilio) | $3,600 |
| Security audits (quarterly) | $20,000 |
| HIPAA compliance consulting | $15,000 |
| AI model training & updates | $10,000 |
| Customer support (1 FTE) | $50,000 |
| **Total (10K users)** | **~$104K/year** |
| **Total (100K users)** | **~$135K/year** |

---

## Appendix A: Pending Questions & Decision Matrix

*[See separate document: PMAction-Questions-Tracker.md]*

---

## Appendix B: Company Information for AI Agents

**Company Name**: PMAction (Positive Mental Action)

**Mission**: Hold users accountable for better mental health through personalized, AI-driven challenges, habit tracking, and therapeutic resources.

**Core Values**:
- Privacy First: User data is encrypted, private, never sold
- Empathy-Driven: System always asks "tell me more" to understand user deeply
- Evidence-Based: All content backed by peer-reviewed research
- Accountability: "Can't Never Could" - encouraging users to take action

**Target Audience**: 
- Primary: Adults 25-45 (working professionals, parents)
- Secondary: Teens 13-18 (school relationships, body image)
- Tertiary: Seniors 65+ (combating loneliness)

**Business Model**:
- Free tier: Basic features (habit tracking, 3 challenges, blog access)
- Premium tier ($9.99/month): All challenges, advanced AI, therapist connection, ad-free
- Referral rewards: Points redeemable for merchandise
- Future: B2B (employer wellness programs, university mental health services)

**Competitive Advantage**:
- AI personalization based on latest mental health research
- Gamification without being trivial (respectful of mental health struggles)
- Privacy-first (no social features that compromise anonymity)
- Integration with licensed therapists (not just self-help)

**Tone & Voice**:
- Warm, supportive, non-judgmental
- Empowering (not prescriptive)
- Conversational (not clinical)
- Example: "We noticed you've been feeling stressed this week. Would you like to try a 5-minute breathing exercise? Tell me more about what's been on your mind."

---

## Appendix C: System-Level Prompt for AI Assistants

You are building a mental health and wellness platform called **PMAction** with the following specifications:

**Core Concept**: A privacy-first, AI-driven mental health platform that holds users accountable through personalized challenges, habit tracking, journaling, quizzes, blog content, and therapist connections. The system emphasizes "Positive Mental Actions" (PMA) and uses the motto "Can't Never Could" to encourage users. The AI always responds with empathy, asking users to "tell me more" to gather context without diagnosing.

**Technical Requirements**:
- **Platform**: Progressive Web App (PWA) using React + Next.js
- **Backend**: Node.js/Express OR Python/FastAPI on Google Cloud Run
- **Database**: PostgreSQL (HIPAA-compliant) on Google Cloud SQL
- **AI**: Google Vertex AI for recommendations, sentiment analysis for journals
- **Security**: AES-256 encryption, TLS 1.3, HIPAA & GDPR compliant
- **Integrations**: Headway API (therapist connection), SendGrid (email), Twilio (SMS), Stripe (payments)

**Key Features to Implement**:
1. User authentication with MFA
2. Mental health assessments (PHQ-9, GAD-7)
3. Habit tracker with streak visualization
4. Encrypted digital journal with sentiment analysis
5. Challenge system (12+ challenges: work relationships, mindfulness, empathy, etc.)
6. Gamification (points, badges, levels, rewards)
7. Blog CMS with SEO optimization
8. Quiz/assessment library
9. AI recommendation engine (suggest challenges, blogs, therapist based on user data)
10. Therapist portal or API integration
11. Referral system with reward points
12. Crisis detection (keyword + ML model) with resource links

**Data Privacy**:
- All journal entries and PHI encrypted at rest
- No data shared with third parties without explicit consent
- User can export/delete all data (GDPR)
- Regional data handling (US: 6-year retention for HIPAA; EU: deletion upon request for GDPR)
- Audit logs for all data access

**AI Behavior**:
- Always ask "tell me more" to gather context
- Never diagnose; only recommend resources
- Detect crisis language (suicide, self-harm) â†’ provide crisis hotline, recommend therapist
- Personalize recommendations based on: mood logs, journal sentiment, challenge progress, quiz results
- Adapt difficulty of challenges based on user performance

**Design Principles**:
- "Scream security": Landing page prominently displays HIPAA, encryption badges
- Clean, modern UI with accessibility (WCAG 2.1 AA)
- Mobile-first design (majority of users on mobile)
- Loading states, offline support (service workers)
- Dark mode option

**Challenges to Build** (see full list in Challenge Library section):
1. Building Better Work Relationships (7 days, adults)
2. Building Better School Relationships (7 days, teens)
3. Understanding Autism: Building Empathy (10 days, all ages)
4. Building Positive Habits (21 days, all ages)
5. Overcoming Social Anxiety (14 days, adults)
6. Mindfulness & Stress Reduction (7 days, all ages)
7. Digital Detox (7 days, all ages)
8. Sleep Hygiene (14 days, all ages)
9. Gratitude Practice (30 days, all ages)
10. Combating Loneliness (14 days, adults/seniors)
11. Body Positivity & Self-Esteem (10 days, teens/young adults)
12. Managing Depression (14 days, adults with therapist oversight)

**MCP Integration**:
- Build MCP server to allow AI assistants (Claude, ChatGPT) to access user data with consent
- Tools: get_mood_log, get_challenge_progress, recommend_next_action, log_journal_entry, search_blog_posts

**Deployment**:
- Google Cloud Platform (us-east-1 primary, us-west-1 backup)
- CI/CD via GitHub Actions
- Kubernetes (GKE) OR Cloud Run (serverless)
- Monitoring: Google Cloud Monitoring + Sentry

**Compliance Checklist**:
- [ ] HIPAA BAA signed with Google Cloud, SendGrid, Twilio
- [ ] Annual security audit
- [ ] Staff HIPAA training
- [ ] Incident response plan
- [ ] 6-year data retention (US), deletion on request (EU)

**Cost Target**:
- MVP: $40-60K development, $500/month hosting
- 10K users: $470/month hosting
- 100K users: $2,500-3,000/month hosting

When building this platform, prioritize user privacy, empathy in AI interactions, and compliance with healthcare regulations. Ensure all features connect to the core mission of "Positive Mental Actions" - measurable, achievable steps toward better mental health.

---

**End of Technical Specification Document**

*Version 1.0 | Created: [Date] | Author: PMAction Development Team*

For questions or clarifications, refer to the companion document: PMAction-Questions-Tracker.md